<html>
<head>
    <title>My library</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css"/>

    <!-- Angular -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/1.0.26/angular-ui-router.js"></script>

    <script>
        angular.module('book-library', ['ui.router'])
            .config(['$stateProvider', '$urlRouterProvider', '$httpProvider', '$sceProvider',
                function ($stateProvider, $urlRouterProvider, $httpProvider, $sceProvider) {
                    $sceProvider.enabled(false);

                    $httpProvider.defaults.withCredentials = true;

                    $urlRouterProvider.otherwise('/');

                    $stateProvider
                        .state({
                            name: 'home',
                            url: '/',
                            templateUrl: './home/home.html',
                            resolve: {
                                books: ['$http', function ($http) {
                                    return $http.get('/book/')
                                        .then(function (response) {
                                            return response.data;
                                        });
                                }]
                            },
                            controller: function ($scope, books) {
                                $scope.books = books;
                            }
                        })
                        .state({
                            name: 'overview',
                            url: '/overview/:id',
                            resolve: {
                                book: ['$http', '$stateParams', function ($http, $stateParams) {
                                    return $http.get('/book/' + $stateParams.id)
                                        .then(function (response) {
                                            return response.data;
                                        });
                                }]
                            },
                            templateUrl: './overview/overview.html',
                            controller: function ($scope, $state, book) {
                                $scope.book = book;
                                $scope.id = $state.params['id'];
                            }
                        })
                        .state({
                            name: 'readBook',
                            url: '/read/:id',
                            templateUrl: './read/read.html',
                            controller: function ($scope, $state) {
                                $scope.id = $state.params['id'];
                            }
                        })
                }])
            .filter('limitText', ['$filter',
                function ($filter) {
                    function limitText(input, limit) {
                        var newContent = $filter('limitTo')(input, limit).trim();
                        if (newContent.length < input.length) {
                            newContent += '...';
                        }
                        return newContent;
                    }

                    return limitText;
                }
            ]);
    </script>
</head>
<body ng-app="book-library">
<div class="container">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" ui-sref="home">My Library</a>
    </nav>
    <div ui-view class="mt-3"></div>
</div>
</body>
</html>